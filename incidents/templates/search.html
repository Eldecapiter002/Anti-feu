{% extends 'base.html' %}
{% block content %}
<h1>Recherche</h1>
<p>Résultats pour : <strong>{{ request.GET.q }}</strong></p>
<div id="results" class="mt-3"></div>

<script>
  const q = new URLSearchParams(window.location.search).get('q') || '';
  if(q){
    fetch('/api/incidents/?search=' + encodeURIComponent(q))
      .then(r => r.json())
      .then(data => {
        const items = data.results || data;
        let html = '';
        if(items.length === 0) html = '<div class="alert alert-warning">Aucun résultat</div>';
        items.forEach(i => {
          html += `<div class="card mb-2"><div class="card-body"><h5>${i.commune} ${i.quartier || ''} — ${i.date}</h5><p>${i.notes || ''}</p></div></div>`;
        });
        document.getElementById('results').innerHTML = html;
      });
  } else {
    document.getElementById('results').innerHTML = '<div class="alert alert-secondary">Entrez un terme de recherche dans la barre du haut.</div>';
  }
</script>
{% endblock %}
